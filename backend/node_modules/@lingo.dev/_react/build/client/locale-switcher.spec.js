import { jsx } from "react/jsx-runtime";
import { describe, it, expect, vi, beforeEach } from "vitest";
import { render, screen, fireEvent } from "@testing-library/react";
import { LocaleSwitcher } from "./locale-switcher.js";
vi.mock("./utils", async (orig) => {
  const actual = await orig();
  return {
    ...actual,
    getLocaleFromCookies: vi.fn(() => "es"),
    setLocaleInCookies: vi.fn()
  };
});
import { getLocaleFromCookies, setLocaleInCookies } from "./utils.js";
describe("LocaleSwitcher", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });
  it("returns null before determining initial locale", () => {
    const { container } = render(/* @__PURE__ */ jsx(LocaleSwitcher, { locales: ["en", "es"] }));
    expect(container.querySelector("select")).toBeTruthy();
  });
  it("uses cookie locale if valid; otherwise defaults to first provided locale", async () => {
    getLocaleFromCookies.mockReturnValueOnce("es");
    render(/* @__PURE__ */ jsx(LocaleSwitcher, { locales: ["en", "es"] }));
    const select = await screen.findByRole("combobox");
    expect(select.value).toBe("es");
    getLocaleFromCookies.mockReturnValueOnce("fr");
    render(/* @__PURE__ */ jsx(LocaleSwitcher, { locales: ["en", "es"] }));
    const selects = await screen.findAllByRole(
      "combobox"
    );
    expect(selects[1].value).toBe("en");
  });
  it("on change sets cookie and triggers full reload", async () => {
    const reloadSpy = vi.fn();
    Object.defineProperty(window, "location", {
      value: { ...window.location, reload: reloadSpy },
      writable: true
    });
    render(/* @__PURE__ */ jsx(LocaleSwitcher, { locales: ["en", "es"] }));
    const select = await screen.findByRole("combobox");
    fireEvent.change(select, { target: { value: "en" } });
    expect(setLocaleInCookies).toHaveBeenCalledWith("en");
    expect(reloadSpy).toHaveBeenCalled();
  });
});
