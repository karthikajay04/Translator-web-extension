import { describe, it, expect, vi, beforeEach } from "vitest";
import { getLocaleFromCookies, setLocaleInCookies } from "./utils.js";
vi.mock("js-cookie", () => {
  return {
    default: {
      get: vi.fn(),
      set: vi.fn()
    }
  };
});
import Cookies from "js-cookie";
describe("client/utils", () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });
  describe("getLocaleFromCookies", () => {
    it("returns null when document is undefined (SSR)", () => {
      const original = globalThis.document;
      delete globalThis.document;
      expect(getLocaleFromCookies()).toBeNull();
      globalThis.document = original;
    });
    it("returns cookie value when present", () => {
      Cookies.get.mockReturnValue("es");
      globalThis.document = {};
      expect(getLocaleFromCookies()).toBe("es");
    });
  });
  describe("setLocaleInCookies", () => {
    it("is no-op when document is undefined", () => {
      const original = globalThis.document;
      delete globalThis.document;
      setLocaleInCookies("fr");
      expect(Cookies.set).not.toHaveBeenCalled();
      globalThis.document = original;
    });
    it("writes cookie with expected options", () => {
      globalThis.document = {};
      setLocaleInCookies("en");
      expect(Cookies.set).toHaveBeenCalledWith("lingo-locale", "en", {
        path: "/",
        expires: 365,
        sameSite: "lax"
      });
    });
  });
});
