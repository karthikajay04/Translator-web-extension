chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"translate-selection",title:"Translate with AI Translator",contexts:["selection"]})});chrome.contextMenus.onClicked.addListener((t,n)=>{if(t.menuItemId!=="translate-selection")return;if(n.url.startsWith("chrome://")||n.url.startsWith("edge://")){chrome.notifications.create({type:"basic",iconUrl:"icons/icon48.png",title:"AI Translator",message:"Cannot translate text on chrome:// or system pages."});return}const e=chrome.runtime.getURL("popup.html")+"?text="+encodeURIComponent(t.selectionText);chrome.windows.create({url:e,type:"popup",width:420,height:600})});chrome.runtime.onMessage.addListener((t,n)=>{t.action==="translatePage"&&chrome.tabs.query({active:!0,currentWindow:!0},e=>{if(!e||!e.length)return;const r=e[0].id;e[0].url.startsWith("chrome://")||chrome.scripting.executeScript({target:{tabId:r},files:["src/content/pageTranslate.js"]},()=>{chrome.tabs.sendMessage(r,{action:"START_FULL_TRANSLATE",targetLang:t.targetLang})})}),t.action==="toggleYoutube"&&(chrome.storage.local.set({youtubeEnabled:t.enabled}),t.enabled?chrome.tabs.query({url:"*://*.youtube.com/watch*"},e=>{e.forEach(r=>{chrome.scripting.executeScript({target:{tabId:r.id},files:["src/content/youtubeTranslate.js"]})})}):chrome.tabs.query({url:"*://*.youtube.com/watch*"},e=>{e.forEach(r=>{chrome.tabs.sendMessage(r.id,{action:"DISABLE_YT_TRANSLATION"})})}))});chrome.tabs.onUpdated.addListener((t,n,e)=>{!n.url&&n.status!=="complete"||!e.url||e.url.startsWith("chrome://")||e.url.includes("youtube.com/watch")&&chrome.storage.local.get(["youtubeEnabled"],r=>{!r.youtubeEnabled||chrome.scripting.executeScript({target:{tabId:t},files:["src/content/youtubeTranslate.js"]})})});
